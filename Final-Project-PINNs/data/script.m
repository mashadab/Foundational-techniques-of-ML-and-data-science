
test_no = 1;

%Given parameters
w  = 2.2/100%Width of the acrylic cell (m)
phi= 0.4    %Porosity 
L  = 1.65   %Length of the domain (m)
mu = 1e-3   %Water viscosity (Pa)
d  = 0.8e-3 %Bead diameter (m)
phi_s = 1   %Sphericity of the particles in the packed bed = 1 for spherical particles
Drho= 1000  %Density of water - air (kg/m^3)
g  = 9.808  %Acceleration due to gravity (m/s^2)

%k = 5.3e-10%Permeability by Cozeny Karman (m^2)
%Using Cozeny-Karman Equation to find absolute permeability (m^2)
k = phi_s^2 * phi^3 * d^2 / (180*(1-phi)^2);  %absolute permeability (m^2)

K = k.*Drho*g/mu;

%Anonymous function for phreatic surface height evaluation
h = @(hs,Q,x,C) sqrt(hs.^2 - 2*Q.*(x-L)/(w*K)*C); %C is a coefficient to fit 
h_nucci = @(h1,Q,x,C) sqrt(h1^2 - 2*Q.*(x)/(w*K) + 2/3*(Q/(w*K))^2 * (1-exp(-3*(x)/(Q/(w*K))))); %C is a coefficient to fit 
h_random= @(h1,Q,x) h1 - Q.*(x-L)./(K*h1*w) - phi^2 * g * (x-L).^2 / (2*K^2)
hc = g*phi^2*L^2/K^2

%Problem parameters
%Test 1
invQ = 152.7;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 6.429596575832281/100; %Seepage face height (m)
C    = 0.75   %Coefficient to fit the data
xmin = 0.174736462383059/100;
x = linspace(xmin,L,1000);

xexp = [0.174736462383059
5.15817876884812
10.3210544657971
15.2397252879688
20.4621306834202
25.3330269564825
30.3359851691236
35.5190466671051
40.3798099032748
45.4692685449200
50.4943115461784
55.5431603831652
60.4712453553231
65.5044313983944
70.4444144789597
75.5049874824343
80.4381239441901
85.4423408211352
90.4227695445485
95.3923386619808
100.285706498504
105.245851888798
110.268588765963
115.418497989885
120.371438326086
125.482208146900
130.725728942818
135.709784818342
140.512553998343
145.883891934291
151.013591191049
155.928811284091
160.852732286543
162.810114741564];
hexp = [6.42369309424172
8.11811203635497
10.0930805815124
11.6459375215904
13.1240601883022
14.5381124383614
15.8115396547246
16.9694860038940
17.9643081114910
18.9463611472001
19.7934207571054
20.6784445706535
21.4578402840720
22.2314523496607
23.0089685238322
23.7100699380262
24.4579129471980
25.0656411303011
25.8553685670863
26.3769754424662
26.8771240140064
27.6455057010831
28.2286508137222
28.8779456866395
29.4076935989044
29.8911352246301
30.2843113851823
30.8751058209332
31.2883458187274
31.7931429061654
32.1741923788043
32.5497815774352
32.6453229320847
32.6490349317179]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)
h_nucci= h_nucci(hexp(end),Q,x)

% keyboard
% 
figure()
comp=plot(x,flip(htest1,2),'k')
hold on
expt=plot(xexp,hexp,'ro');
expt=plot(x,real(h_nucci),'ro');
legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
legend('Location','northwest')
set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
xlabel('$$x \quad (m)$$','Interpreter','latex')
title('$$Test \quad 1$$','Interpreter','latex')
print(gcf,'Test_1.png','-dpng','-r600');

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;

%{
%Problem parameters
%Test 2
invQ = 136.125;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 7.356226241746091/100; %Seepage face height (m)
C    = 0.90   %Coefficient to fit the data
xmin = 0.151136254882805/100;
x = linspace(xmin,L,1000);

xexp = [0.151136254882805
5.07537528259564
10.1738469671616
15.0827104327379
20.1844095448549
25.0035605068176
29.9750993292020
35.1362494303747
39.9572698987193
44.9560137004743
49.9706125246443
54.9809483813884
59.9456663823111
64.8613327628172
69.8211121740669
74.8395740380299
79.8058476432566
84.7719260802113
89.7732056552393
94.7961936039407
99.6711763031104
104.664068795913
109.704970461469
114.920418278895
119.892406406125
125.112851086784
130.276629121819
135.295614373644
140.135635475181
145.614801143684
150.837029325584
155.748010810124
160.771410128978
161.956799815837];
hexp = [7.35622624174609
9.63310571399654
11.9030218944374
13.9936946865750
15.8956841300492
17.2028121024328
18.7106023139705
19.8448297317402
21.0684794338827
22.2068165001234
23.2045442362712
24.1474458483761
25.0948418977848
26.0321885895223
26.7311916441546
27.5836687594707
28.2343876640212
28.9067405791579
29.8274553636654
30.3438813716798
31.0381218964578
31.6582217178158
32.3032793297758
32.9572411984746
33.5223606496679
34.1477847812044
34.6915520499201
35.1614699834880
35.4931906731835
35.5141431201870
35.5752676394758
35.5564059821417
35.5952825626335
35.5927615312845]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;

% figure()
% comp=plot(x,flip(htest1,2),'k')
% hold on
% expt=plot(xexp,hexp,'ro');
% legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
% set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
% xlabel('$$x \quad (m)$$','Interpreter','latex')
% legend('Location','northwest')
% title('$$Test \quad 2$$','Interpreter','latex')
% print(gcf,'Test_2.png','-dpng','-r600');

%Problem parameters
%Test 4
invQ = 711.1429;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 4.287479366828525/100; %Seepage face height (m)
C    = 1.0   %Coefficient to fit the data
xmin = 0.132205156232452/100;
x = linspace(xmin,L,1000);

xexp = [0.132205156232452
4.86930102747858
9.82773800844655
14.6567956446908
19.6743074859895
24.4542534779640
29.3473957623784
34.3392122712255
39.2224067636933
44.2970179397543
49.2397155223514
54.2461339280538
59.2001343016917
64.1968613994744
69.1515188622018
74.2737702643620
79.2438748152222
84.2677668830549
89.2460205521312
94.2659651491821
99.2578264138721
104.278054249925
109.275789766513
114.459607190395
119.478844207333
124.720003912660
129.877359390656
134.851392182492
139.812010082422
145.147134488528
150.196556332106
155.237603706103
160.354407365037
162.277093431573];
hexp = [4.28747936682853
5.28922455075987
6.38548250313639
7.19536784686425
7.94554922135735
8.63361395985398
9.25900297105250
9.80369227213715
10.2130889130100
10.7786764433963
11.3597881092829
11.7358501651780
12.3588287745426
12.6467237345522
13.2017126406876
13.5818917948750
13.8819667136749
14.2141956437112
14.6258676274943
14.9234715041063
15.2454125265609
15.5783668381027
15.8801672142266
16.2341868793059
16.4739598386098
16.8027231604276
17.0301752968421
17.2033446052046
17.3798284682984
17.5716971421027
17.8124513112167
18.0256331782369
18.3384759996209
18.4512192796912]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;


% figure()
% comp=plot(x,flip(htest1,2),'k')
% hold on
% expt=plot(xexp,hexp,'ro');
% legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
% set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
% legend('Location','northwest')
% xlabel('$$x \quad (m)$$','Interpreter','latex')
% title('$$Test \quad 4$$','Interpreter','latex')
% print(gcf,'Test_4.png','-dpng','-r600');

%Problem parameters
%Test 6
invQ = 127.6667;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 8.235305268748833/100; %Seepage face height (m)
C    = 0.80   %Coefficient to fit the data
xmin = 0.259971830111854/100;
x = linspace(xmin,L,1000);

xexp = [0.259971830111854
4.94336211367009
9.94045312323807
14.7686438331891
19.8478872777906
24.5961426843510
29.5452086127965
34.7192448662670
39.5478083337693
44.5736462448547
49.6422243832713
54.6875358618110
59.6813000710130
64.6887930993780
69.7218482974266
74.8117523276027
79.8114437746860
84.8656573709157
89.9504041654983
95.0197870210072
99.9615267807681
105.009207278363
110.104418816843
115.390487759506
120.377280034652
125.620021753071
130.793383116188
135.812351047649
140.616097720607
146.047520040461
151.192165919760
156.027308277590
160.913993597191
161.953875723618];
hexp = [8.23530526874883
10.5840164964415
12.9425039498519
14.9586098510508
16.8219912342558
18.1470067161222
19.5630401881385
20.8322605713460
22.0226836119405
23.1007252749501
24.1079147496281
25.0480403449311
26.0077649284799
26.7582778528646
27.5619132670376
28.4131530659555
29.1181049714285
29.7087801420839
30.2446018399771
30.7356697286453
31.4775788043217
32.1968915903288
32.8945466858858
33.6827490196393
34.4165596538516
34.7919485927237
35.1527885049610
35.2570741014403
35.3765132479366
35.2531550209691
35.2971332064423
35.2250196470895
35.1707019078080
35.1576605612774]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;
% figure()
% comp=plot(x,flip(htest1,2),'k')
% hold on
% expt=plot(xexp,hexp,'ro');
% legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
% set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
% legend('Location','northwest')
% xlabel('$$x \quad (m)$$','Interpreter','latex')
% title('$$Test \quad 6$$','Interpreter','latex')
% print(gcf,'Test_6.png','-dpng','-r600');


%Problem parameters
%Test 7
invQ = 145.3333;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 8.1763/100; %Seepage face height (m)
C    = 0.80   %Coefficient to fit the data
xmin = 0.269775513772470/100;
x = linspace(xmin,L,1000);

xexp = [0.269775513772470
4.97503889209149
9.99599226502200
14.8469480175225
19.8877340598294
24.6800004716587
29.6346518853921
34.7577218171750
39.5369463018781
44.5528345037373
49.5692779337455
54.5496317398059
59.5101471638692
64.4273556853461
69.4196363758261
74.4470542317300
79.4112314833889
84.4401221759596
89.4331540156138
94.4469849661246
99.3711830634168
104.328861938156
109.319869667647
114.551593475134
119.485744663216
124.695351154427
129.860233611532
134.848116964624
139.605559556063
145.047605779495
150.186560625154
155.035309747234
159.942314917185
160.824944783697];
hexp = [8.17633289907465
10.2291635530369
12.3824966205692
14.2980628380699
16.0115659056963
17.2733419934560
18.6364042107283
19.8061330267388
20.6871474243310
21.8044928090853
22.7752139816561
23.6281212620805
24.4723290703415
25.1433113454769
25.8088542531491
26.6871040535370
27.4000130464754
28.0643068377855
28.5952190881569
29.2526425145799
29.7380683440518
30.2539445573408
30.7697866616345
31.3721931966850
31.8861644450186
32.4111779230515
32.9911726691745
33.7442730729975
33.9901655415311
34.5977845081016
35.2587995350437
35.2556273681541
35.2138264002146
35.2354922648551]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;

% figure()
% comp=plot(x,flip(htest1,2),'k')
% hold on
% expt=plot(xexp,hexp,'ro');
% legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
% set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
% legend('Location','northwest')
% xlabel('$$x \quad (m)$$','Interpreter','latex')
% title('$$Test \quad 7$$','Interpreter','latex')
% print(gcf,'Test_7.png','-dpng','-r600');

%Problem parameters
%Test 8
invQ = 145.3333;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 8.3787/100; %Seepage face height (m)
C    = 1.0   %Coefficient to fit the data
xmin = 0.266901697713234/100;
x = linspace(xmin,L,1000);

xexp = [0.266901697713234
4.89887608816937
9.82023651460757
14.6162147612778
19.6060096701262
24.3547915673557
29.2895567241982
34.4574471433891
39.2469296945696
44.3124848543661
49.3632933075969
54.4283410768971
59.4471719780994
64.4345931670576
69.5242254258973
74.6237665491983
79.6821472627117
84.7946224441596
89.8763201759696
95.0270955444735
99.9925355430273
105.064037810120
110.238477783818
115.551502356626
120.580699535048
125.837598272345
131.011770601950
136.061175006904
140.852233886399
146.294130236901
151.443880175386
156.266855855674
161.151847888248
162.300529903528];
hexp = [8.37865546254588
11.1494417571401
13.5916002258947
15.9762671080309
17.4759455119213
19.1959369483503
20.7830130149709
22.1915843353000
23.4094475414090
24.6452410694629
25.6870416169145
26.6135863370790
27.5914154167401
28.4464635575791
29.3459108615873
30.1882408845819
30.9791411593919
31.6982477579095
32.3751944442754
33.0559869017456
33.5920453709574
34.5037812126798
35.6199337931078
35.7819383734320
35.7936244086219
35.8613719023133
35.9254543870122
36.0216933123425
35.9820473739868
35.9460648899392
36.0326039609422
35.9600641192258
35.9479696521584
35.9394112541393]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;

% figure()
% comp=plot(x,flip(htest1,2),'k')
% hold on
% expt=plot(xexp,hexp,'ro');
% legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
% set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
% legend('Location','northwest')
% xlabel('$$x \quad (m)$$','Interpreter','latex')
% title('$$Test \quad 8$$','Interpreter','latex')
% print(gcf,'Test_8.png','-dpng','-r600');

%Problem parameters
%Test 9
invQ = 99;  %Volumetric flow rate (s/litre == s/dm^3)
hs   = 9.3054/100; %Seepage face height (m)
C    = 0.80   %Coefficient to fit the data
xmin = 0.521501215574918/100;
x = linspace(xmin,L,1000);

xexp = [0.521501215574918
5.25813009309375
10.2620533790703
15.1498461953836
20.2117801901377
25.0063432143140
29.9927514808150
35.2287144198066
40.0730389891644
45.1763023865358
50.2819805018245
55.3662055856291
60.4396329562686
65.4335215206274
70.5386598746556
75.6785929980715
80.7807322167116
85.9237623877333
91.0075446804569
96.2104953377245
101.138019587131
106.221205938176
111.353519652675
116.681309270583
121.700060099807
126.959160524230
132.107817802616
137.176320713504
141.940436993342
147.381851380312
152.518402383977
157.333788183290
162.217421192068
163.366327203687];
hexp = [9.30539676439061
11.8390703906902
14.6925849238432
17.2422441190052
18.8917991955917
20.3109687091557
21.8867209683268
23.3674648513231
24.5702666799537
25.7673631539125
26.9593495560632
28.1287044199476
29.1439430532312
29.8238246145135
30.6707653444004
31.6968144847025
32.5490430278839
33.3125839125619
34.0332169801954
34.7096110926739
35.0467010847250
35.4056712987656
35.5755538156725
35.6930471268020
35.6830604327916
35.7568391533977
35.8304757441955
35.8829393108481
35.8327727973886
35.8128914961289
35.9000246684783
35.8243560655865
35.8081837967498
35.8038861147957]

%Conversion
Q = 1./(invQ*1000);
xexp = xexp./100;
hexp = hexp./100;
htest1 = h(hs,Q,x,C)

save(sprintf("exp%d", test_no), 'xexp', 'hexp', 'K', 'L', 'w', 'Q')
test_no = test_no + 1;
}%
% figure()
% comp=plot(x,flip(htest1,2),'k')
% hold on
% expt=plot(xexp,hexp,'ro');
% legend([comp expt],'$$Analytical$$','$$Experiment$$','Interpreter','latex')
% set(gca,'FontSize',14); set(gca,'TickLabelInterpreter','latex'); ylabel('$$h \quad (m)$$','Interpreter','latex')
% legend('Location','northwest')
% xlabel('$$x \quad (m)$$','Interpreter','latex')
% title('$$Test \quad 9$$','Interpreter','latex')
% print(gcf,'Test_9.png','-dpng','-r600');
%}